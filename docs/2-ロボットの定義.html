<!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <title>2 &#x30ed;&#x30dc;&#x30c3;&#x30c8;&#x306e;&#x5b9a;&#x7fa9;</title>
        <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

</style>
        
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
        
    </head>
    <body class="vscode-body vscode-light">
        <h1 id="2-ロボットの定義">2 ロボットの定義</h1>
<p>この項では新たなロボットの定義について説明します。</p>
<h2 id="dll-ファイル">DLL ファイル</h2>
<p>ロボットの機能は .NET Assembly DLL として実装します。
このDLLファイルは全てプロジェクト<code>Wimm.Machines</code>及び<code>Wimm.Common</code>へ依存します。</p>
<p>以下に重要なクラスを紹介します。</p>
<h2 id="wimmmachinesmachine-abstract-class"><code>Wimm.Machines.Machine</code> Abstract Class</h2>
<p>全てのロボットが継承する共通抽象クラスです。派生クラスはこのクラスが提供するプロパティやメソッドを実装します。</p>
<p>各クラスは<code>.ctor(Wimm.Machines.MachineConstructorArgs?)</code>のシグネチャのコンストラクタを必要とします。未定義であればWimmが呼び出しに失敗します。</p>
<hr>
<h2 id="featuref-where-fdelegate-class"><code>Feature&lt;F&gt; where F:Delegate</code> Class</h2>
<p>モジュールが持つ機能を表現するクラスです。スクリプトとの相互運用を想定して設計されました。<br>
一つの<code>Feature</code>インスタンスと一つのメソッドが対応します。<code>F</code>は機能を実装した関数の型です。</p>
<h3 id="name-property"><code>Name</code> Property</h3>
<p>スクリプトからの参照に用いる名前です。</p>
<h3 id="description-property"><code>Description</code> Property</h3>
<p>機能の説明を与えます。引数等の情報を記述すると良いでしょう。</p>
<h3 id="f-function-property">F <code>Function</code> Property</h3>
<p>スクリプトから呼び出す関数を格納します。NeoLuaから呼び出すため、戻り値と引数ともに簡単なプリミティブ型であることを推奨します。(int double stringなど)</p>
<hr>
<h2 id="module-abstract-class"><code>Module</code> Abstract Class</h2>
<p>ロボットが持つパーツを表現するクラスです。
モーターの場合は<code>Motor</code>クラス、サーボモーターの場合は<code>ServoMotor</code>クラスを継承することを強く推奨します。</p>
<p>制御スクリプトに公開される<code>Name</code>, <code>Description</code>、そしてそのモジュールが提供する<code>Feature</code>のリストである<code>Features</code>プロパティを持ちます。</p>
<h3 id="name-property-1"><code>Name</code> Property</h3>
<p>スクリプトからはアクセスされる際に用いる名前です。Lua言語の変数として問題のない形であることを推奨します。</p>
<hr>
<h2 id="loadtargetattribute-class"><code>LoadTargetAttribute</code> Class</h2>
<p>Wimmの読み込み対象となる<code>Machine</code>クラスに与える属性です。</p>
<hr>
<h2 id="ロボット-フォルダ">ロボット フォルダ</h2>
<p>Wimmにロボット定義ファイルを読み込ませると自動的にそのロボットのフォルダが展開されます。</p>
<h3 id="例">例</h3>
<ul>
<li>{wimm.exe} : 実行ファイル</li>
<li>Machines
<ul>
<li>Machine1 : dllと同じ名前
<ul>
<li>icon.png 正方形をおすすめ、なくてもいいけどその場合Wimmにアイコンは表示されない</li>
<li>Machine1.dll : Machineクラスを定義したdll</li>
<li>description.txt : ロボットの説明を記述できます。現在Wimmからは使用されていません</li>
<li>meta_info.json : ロボットの名前と制御ボードの名前などを定義</li>
<li>config.json : ロボットに与える情報のうちユーザーが書き換えられ、単純な文字列として与えられるデータ。</li>
<li>script
<ul>
<li>initialize.neo.lua : 初期化時に一番最初に一回呼び出されます</li>
<li>definition.neo.lua : 初期化時に一回呼び出されます。関数やグローバル変数定義を行う</li>
<li>control_map.neo.lua : 初期化時に一回呼び出されます(最後)。コントローラーの入力と呼び出す関数を紐づけます。</li>
<li>on_control.neo.lua : 毎制御処理毎に呼び出されます。単純なコントローラーとのマッピングでは制御できない複雑なコントロールを処理</li>
<li>macro : マクロ処理を定義します。
<ul>
<li>macros.json</li>
<li>1.neo.lua</li>
<li>2.neo.lua</li>
<li>...</li>
</ul>
</li>
</ul>
</li>
<li>docs : スクリプトを書くにあたって必要な情報がWimmから提供されるフォルダ、中身は未定義</li>
</ul>
</li>
</ul>
</li>
</ul>

        
        
    </body>
    </html>